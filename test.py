import streamlit as st
from datetime import datetime
import random

# -------------------- í˜ì´ì§€ ì„¤ì • --------------------
st.set_page_config(page_title="ë‚´ê°€ ì›¹íˆ°ì— ë“¤ì–´ê°„ë‹¤ë©´?", page_icon="ğŸ“–", layout="centered")

# -------------------- ë°°ê²½ (ì •ì  ë³„) --------------------
star_html = ""
for _ in range(150):
    top = random.randint(0, 95)
    left = random.randint(0, 95)
    size = random.randint(2, 5)
    star_html += f'<div style="position:absolute; top:{top}%; left:{left}%; width:{size}px; height:{size}px; background:#FFD700; border-radius:50%;"></div>'

st.markdown(f"""
<style>
.stApp {{
    background-color: black;
    position: relative;
    overflow: hidden;
}}
.title {{
    font-size: 42px;
    color: #FFD700;
    text-align: center;
    margin-top: 30px;
    text-shadow: 0 0 15px #FFD700;
}}
.report {{
    background: rgba(20,20,20,0.85);
    border: 2px solid #FFD700;
    border-radius: 10px;
    padding: 25px;
    margin-top: 20px;
    color: #f5f5dc;
    font-size: 18px;
    line-height: 1.7;
    box-shadow: 0 0 20px rgba(255,215,0,0.5);
}}
.report h3 {{
    color: #FFD700;
    text-shadow: 0 0 6px #FFD700;
}}
</style>
<div>{star_html}</div>
""", unsafe_allow_html=True)

# -------------------- ì œëª© --------------------
st.markdown('<h1 class="title">ë‚´ê°€ ì›¹íˆ°ì— ë“¤ì–´ê°„ë‹¤ë©´?</h1>', unsafe_allow_html=True)
st.write("âœ¨ ë³„ë¹› ì•„ë˜ í™©ê¸ˆë¹› ì‹¤ì œ ì‚¬ì£¼í’€ì´ë¡œ ë‹¹ì‹ ì˜ ì›¹íˆ° ìºë¦­í„° ìš´ëª…ì„ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤ âœ¨")

# -------------------- ì…ë ¥í¼ --------------------
with st.form("user_form"):
    name = st.text_input("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”")
    gender = st.radio("ì„±ë³„ì„ ì„ íƒí•˜ì„¸ìš”", ["ì—¬ì", "ë‚¨ì"])
    birth_date = st.date_input("ìƒë…„ì›”ì¼", min_value=datetime(1900,1,1), max_value=datetime.today())
    birth_time = st.time_input("ì¶œìƒ ì‹œê°„")
    submitted = st.form_submit_button("ê²°ê³¼ ë³´ê¸°")

# -------------------- ì‹¤ì œ ì‚¬ì£¼í’€ì´ --------------------
if submitted:
    # ì²œê°„/ì§€ì§€ ë¦¬ìŠ¤íŠ¸
    heavenly_stems = ["ê°‘","ì„","ë³‘","ì •","ë¬´","ê¸°","ê²½","ì‹ ","ì„","ê³„"]
    earthly_branches = ["ì","ì¶•","ì¸","ë¬˜","ì§„","ì‚¬","ì˜¤","ë¯¸","ì‹ ","ìœ ","ìˆ ","í•´"]

    year, month, day, hour = birth_date.year, birth_date.month, birth_date.day, birth_time.hour

    # ì—°ì£¼ ê³„ì‚° (ê°„ë‹¨ ë²„ì „)
    year_stem = heavenly_stems[(year-4)%10]
    year_branch = earthly_branches[(year-4)%12]

    # ì›”ì£¼ ê³„ì‚° (ë‹¨ìˆœí™”, ì‹¤ì œëŠ” íƒœì–‘ë ¥ ê¸°ì¤€)
    month_stem = heavenly_stems[(year*12 + month + 3)%10]
    month_branch = earthly_branches[(month+1)%12]

    # ì¼ì£¼ ê³„ì‚° (ê°„ë‹¨í™”)
    day_stem = heavenly_stems[(year*365 + month*30 + day)%10]
    day_branch = earthly_branches[(year*365 + month*30 + day)%12]

    # ì‹œì£¼ ê³„ì‚°
    hour_branch_index = (hour+1)//2 % 12
    hour_branch = earthly_branches[hour_branch_index]
    hour_stem = heavenly_stems[(hour_branch_index + day_stem.count(''))%10]  # ê°„ë‹¨ ê³„ì‚°

    # -------------------- ì˜¤í–‰ ë° ì‹­ì„± ë¶„ì„ --------------------
    stem_to_element = {"ê°‘":"ëª©","ì„":"ëª©","ë³‘":"í™”","ì •":"í™”","ë¬´":"í† ","ê¸°":"í† ","ê²½":"ê¸ˆ","ì‹ ":"ê¸ˆ","ì„":"ìˆ˜","ê³„":"ìˆ˜"}
    branch_to_element = {"ì":"ìˆ˜","ì¶•":"í† ","ì¸":"ëª©","ë¬˜":"ëª©","ì§„":"í† ","ì‚¬":"í™”","ì˜¤":"í™”","ë¯¸":"í† ","ì‹ ":"ê¸ˆ","ìœ ":"ê¸ˆ","ìˆ ":"í† ","í•´":"ìˆ˜"}

    # ì¼ê°„ ê¸°ì¤€ ì„±ê²©
    day_element = stem_to_element[day_stem]
    element_report = {
        "ëª©":{"ì„±ê²©":"ëŠì„ì—†ëŠ” ì„±ì¥ê³¼ ë„ì „ì„ ì¶”êµ¬í•˜ëŠ” íƒ€ì…. ëª¨í—˜ê³¼ ê°œì²™ì„ ì¦ê¹ë‹ˆë‹¤.",
              "ì—°ì• ":"ììœ ë¡­ê³  ì—´ì •ì ì¸ ì—°ì• ë¥¼ ì¦ê¹ë‹ˆë‹¤.",
              "ì¬ë¬¼":"ê³„íšì  íˆ¬ìì™€ ë…¸ë ¥ì´ ì¬ë¬¼ìš´ìœ¼ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤.",
              "í˜„ì¬":"ìƒˆë¡œìš´ ê¸°íšŒê°€ ë‹¤ê°€ì˜¤ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.",
              "ë¯¸ë˜":"í° ì„±ì·¨ë¥¼ ì´ë£¨ê³  ì§€ë„ìì  ìœ„ì¹˜ì— ì„¤ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤."},
        "í™”":{"ì„±ê²©":"ì—´ì •ê³¼ ì¶”ì§„ë ¥ì´ ê°•í•˜ë©°, ê°ì •ì— ì†”ì§í•©ë‹ˆë‹¤.",
              "ì—°ì• ":"ë¶ˆê½ƒê°™ì€ ì—°ì• ë¥¼ í•˜ë©° ìƒëŒ€ì—ê²Œ ê°•í•œ ì¸ìƒì„ ë‚¨ê¹ë‹ˆë‹¤.",
              "ì¬ë¬¼":"ë„ì „ì  íˆ¬ìê°€ ì¢‹ì€ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
              "í˜„ì¬":"ì›í•˜ëŠ” ëª©í‘œë¥¼ í–¥í•´ ëŒì§„í•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.",
              "ë¯¸ë˜":"í° ì„±ê³µì„ ì´ë£¨ì§€ë§Œ ì¡°ê¸‰í•¨ì„ ë‹¤ìŠ¤ë ¤ì•¼ í•©ë‹ˆë‹¤."},
        "í† ":{"ì„±ê²©":"ì•ˆì •ì ì´ë©° ì„±ì‹¤í•©ë‹ˆë‹¤. ì‹ ë¢°ì™€ ë¯¿ìŒì„ ì¤ë‹ˆë‹¤.",
              "ì—°ì• ":"í¸ì•ˆí•˜ê³  ì•ˆì •ì ì¸ ê´€ê³„ë¥¼ ì„ í˜¸í•©ë‹ˆë‹¤.",
              "ì¬ë¬¼":"ê¾¸ì¤€í•œ ë…¸ë ¥ì´ ì¬ë¬¼ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤.",
              "í˜„ì¬":"ì„±ì‹¤í•¨ì´ ì¸ì •ë°›ê³  ì•ˆì •ì ì¸ íë¦„ì´ ì´ì–´ì§‘ë‹ˆë‹¤.",
              "ë¯¸ë˜":"ì˜¤ë«ë™ì•ˆ ì¡´ê²½ë°›ëŠ” ì¡°ì–¸ìë‚˜ ë©˜í† ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤."},
        "ê¸ˆ":{"ì„±ê²©":"ëƒ‰ì² í•˜ê³  ê²°ë‹¨ë ¥ ìˆìœ¼ë©° ì¹´ë¦¬ìŠ¤ë§ˆê°€ ìˆìŠµë‹ˆë‹¤.",
              "ì—°ì• ":"ë§¤ë ¥ì ì´ì§€ë§Œ ì°¨ê°€ìš´ ì¸ìƒì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
              "ì¬ë¬¼":"ê¶Œìœ„ì™€ ëª…ì˜ˆë¥¼ ì–»ìœ¼ë©° ì¬ë¬¼ìš´ë„ ì¢‹ìŠµë‹ˆë‹¤.",
              "í˜„ì¬":"ëª©í‘œë¥¼ í–¥í•´ ì§‘ì¤‘í•  ìˆ˜ ìˆëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.",
              "ë¯¸ë˜":"ê°•ë ¬í•œ ì¸ìƒì„ ë‚¨ê¸°ë©° ì¤‘ìš”í•œ ìœ„ì¹˜ì— ì„¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤."},
        "ìˆ˜":{"ì„±ê²©":"ì§€í˜œë¡­ê³  ì‹ ë¹„ë¡œìš°ë©° ì§ê´€ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.",
              "ì—°ì• ":"ìƒëŒ€ì˜ ë§ˆìŒì„ ì˜ ì½ê³  ì´í•´í•©ë‹ˆë‹¤.",
              "ì¬ë¬¼":"ì§€í˜œë¡œìš´ ì„ íƒì´ ì¬ë¬¼ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤.",
              "í˜„ì¬":"ì§ê´€ì´ ë¹›ë‚˜ê³  ìƒˆë¡œìš´ ì•„ì´ë””ì–´ê°€ ë– ì˜¤ë¥´ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.",
              "ë¯¸ë˜":"ì§€í˜œì™€ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ íŠ¹ë³„í•œ ê¸¸ì„ ê±¸ì–´ê°‘ë‹ˆë‹¤."}
    }

    report = element_report[day_element]

    # -------------------- ì¶œë ¥ --------------------
    st.markdown(f"""
    <div class="report">
        <h3>ğŸ”® {name}ë‹˜ì˜ ì›¹íˆ°í˜• ì‚¬ì£¼ ë¦¬í¬íŠ¸</h3>
        <p><b>ì„±ë³„:</b> {gender}</p>
        <p><b>ìƒë…„ì›”ì¼:</b> {birth_date.strftime('%Y-%m-%d')}</p>
        <p><b>ì¶œìƒì‹œê°:</b> {birth_time.strftime('%H:%M')}</p>
        <hr>
        <p><b>ì‚¬ì£¼íŒ”ì:</b><br>
           {year_stem}{year_branch} / {month_stem}{month_branch} / {day_stem}{day_branch} / {hour_stem}{hour_branch}
        </p>
        <hr>
        <h3>ğŸŒŸ ì„±ê²©</h3>
        <p>{report['ì„±ê²©']}</p>
        <h3>ğŸ“ í˜„ì¬ ìš´ì„¸</h3>
        <p>{report['í˜„ì¬']}</p>
        <h3>ğŸ”® ë¯¸ë˜ ìš´ì„¸</h3>
        <p>{report['ë¯¸ë˜']}</p>
        <h3>ğŸ’– ì—°ì• ìš´</h3>
        <p>{report['ì—°ì• ']}</p>
        <h3>ğŸ’° ì¬ë¬¼ìš´</h3>
        <p>{report['ì¬ë¬¼']}</p>
    </div>
    """, unsafe_allow_html=True)
