import streamlit as st
from datetime import datetime

# -------------------- 페이지 설정 --------------------
st.set_page_config(page_title="내가 웹툰에 들어간다면?", page_icon="📖", layout="centered")

# -------------------- CSS 스타일 --------------------
st.markdown("""
<style>
.stApp {
    background-color: #0a0a0a;
    color: #FFD700;
    font-family: 'Arial', sans-serif;
}
.title {
    font-size: 48px;
    text-align: center;
    margin-top: 20px;
    font-weight: bold;
    color: #FFD700;
    text-shadow: 0 0 20px #FFD700;
}
.report {
    background: rgba(20,20,20,0.95);
    border: 2px solid #FFD700;
    border-radius: 15px;
    padding: 30px;
    margin-top: 30px;
    line-height: 1.8;
    box-shadow: 0 0 25px rgba(255,215,0,0.5);
}
.report h3 {
    color: #FFD700;
    text-shadow: 0 0 10px #FFD700;
}
hr {
    border: 1px solid #FFD700;
}
</style>
""", unsafe_allow_html=True)

# -------------------- 제목 --------------------
st.markdown('<div class="title">내가 웹툰에 들어간다면?</div>', unsafe_allow_html=True)
st.write("✨ 웅장한 황금빛 사주풀이로 당신의 웹툰 캐릭터 운명을 확인하세요 ✨")

# -------------------- 입력 --------------------
with st.form("user_form"):
    name = st.text_input("이름을 입력하세요")
    gender = st.radio("성별을 선택하세요", ["여자", "남자"])
    birth_date = st.date_input("생년월일", min_value=datetime(1900,1,1), max_value=datetime.today())
    submitted = st.form_submit_button("결과 보기")

# -------------------- 천간/지지 --------------------
heavenly_stems = ["갑","을","병","정","무","기","경","신","임","계"]
earthly_branches = ["자","축","인","묘","진","사","오","미","신","유","술","해"]
stem_to_element = {"갑":"목","을":"목","병":"화","정":"화","무":"토","기":"토","경":"금","신":"금","임":"수","계":"수"}

# -------------------- 사주풀이 --------------------
if submitted:
    year, month, day = birth_date.year, birth_date.month, birth_date.day

    # 연주
    year_stem = heavenly_stems[(year-4)%10]
    year_branch = earthly_branches[(year-4)%12]

    # 월주 (간단하지만 조금 더 정교하게)
    month_stem = heavenly_stems[(year*12 + month)%10]
    month_branch = earthly_branches[(month+1)%12]

    # 일주
    day_stem = heavenly_stems[(year*365 + month*30 + day)%10]
    day_branch = earthly_branches[(year*365 + month*30 + day)%12]

    # 오행 분석 (일주 기준)
    day_element = stem_to_element[day_stem]

    element_report = {
        "목":{"성격":"끊임없는 성장과 도전을 추구하며, 새로운 지식과 경험을 탐구하는 모험가형 성격입니다. 친구나 동료를 격려하고 영감을 주지만, 때로는 지나치게 완벽을 추구해 스스로 부담을 느낄 수 있습니다.",
              "연애":"자유롭고 열정적인 연애를 즐기며, 상대에게 새로운 경험과 활력을 제공합니다. 독립성을 중시해 구속을 싫어할 수 있습니다.",
              "재물":"계획적 투자와 꾸준한 노력이 재물운으로 이어지며, 새로운 사업 기회를 잘 활용할 수 있습니다.",
              "현재":"지금은 새로운 도전과 기회가 다가오는 시기로, 자신의 능력을 시험하고 성장할 수 있는 중요한 시기입니다.",
              "미래":"장기적 관점에서 큰 성취를 이루며, 지도자적 위치에 서거나 새로운 분야를 개척할 가능성이 높습니다.",
              "웹툰":"모험가, 도전적인 주인공으로 활약하며 주변에 활력을 불어넣는 캐릭터"},
        "화":{"성격":"열정과 추진력이 강하며, 자신의 감정과 의견을 솔직하게 표현하는 타입입니다. 다소 충동적일 수 있지만, 상황에 따라 카리스마와 리더십을 발휘합니다.",
              "연애":"강렬하고 불꽃 같은 연애를 하며, 상대방에게 깊은 인상을 남깁니다. 다툼이 생길 수 있으나 금방 화해하는 성향이 있습니다.",
              "재물":"도전적인 투자나 창의적 아이디어로 재물운이 상승하며, 새로운 기회를 잘 포착합니다.",
              "현재":"목표를 향해 강하게 나아가는 시기로, 에너지와 추진력이 빛나는 시기입니다.",
              "미래":"큰 성공을 이루지만, 조급함을 조절하고 신중함을 유지해야 장기적으로 안정적인 성취를 얻습니다.",
              "웹툰":"불꽃 전사, 액션 중심 인물로 모험과 갈등의 중심에 서는 캐릭터"},
        "토":{"성격":"안정적이고 신뢰감을 주며, 주변 사람들에게 든든한 버팀목이 되는 타입입니다. 차분하고 책임감이 강하며, 꾸준히 목표를 향해 나아갑니다.",
              "연애":"편안하고 안정적인 관계를 선호하며, 상대와 함께 성장하는 사랑을 지향합니다.",
              "재물":"꾸준한 노력과 성실함이 재물운으로 이어지며, 장기적 안정성을 중시합니다.",
              "현재":"성실함이 인정받고 있으며, 안정적인 흐름 속에서 능력을 발휘할 수 있는 시기입니다.",
              "미래":"오랫동안 존경받는 조언자, 멘토가 되거나 신뢰받는 위치에서 영향력을 행사할 가능성이 큽니다.",
              "웹툰":"지혜로운 조력자, 든든한 멘토로 등장하여 주인공을 지원하는 캐릭터"},
        "금":{"성격":"냉철하고 결단력이 있으며, 강한 의지와 카리스마를 가진 타입입니다. 목표를 명확히 설정하고 효율적으로 행동합니다.",
              "연애":"매력적이지만 다소 차갑게 보일 수 있으며, 상대에게 깊은 신뢰를 요구합니다.",
              "재물":"권위와 명예를 얻으며, 전략적 선택이 재물운을 향상시킵니다.",
              "현재":"집중력과 결단력이 필요한 시기로, 목표 달성을 위해 전력을 다해야 하는 시기입니다.",
              "미래":"중요한 위치에서 영향력을 행사하고, 강렬한 인상을 남기며 성공적인 결과를 얻을 가능성이 높습니다.",
              "웹툰":"강력한 라이벌, 카리스마 있는 지도자형 캐릭터"},
        "수":{"성격":"지혜롭고 신비로우며 직관력이 뛰어난 타입입니다. 상황을 유연하게 판단하고, 숨은 능력과 통찰력을 발휘합니다.",
              "연애":"상대의 마음을 잘 읽고 이해하며, 신비로운 매력으로 사람을 끌어당깁니다.",
              "재물":"현명한 선택과 직관력이 재물운으로 이어지며, 기회를 놓치지 않고 활용할 수 있습니다.",
              "현재":"직관과 창의성이 빛나는 시기로, 새로운 아이디어와 계획을 실현할 기회가 많습니다.",
              "미래":"지혜와 경험을 바탕으로 특별한 길을 걸으며, 남들과 다른 독창적인 성취를 이룰 가능성이 높습니다.",
              "웹툰":"비밀을 간직한 현자, 신비로운 인물로 등장하며 이야기의 핵심을 좌우하는 캐릭터"}
    }

    report = element_report[day_element]

    # -------------------- 결과 출력 --------------------
    st.markdown(f"""
    <div class="report">
        <h3>🔮 {name}님의 웹툰형 사주 리포트</h3>
        <p><b>성별:</b> {gender}</p>
        <p><b>생년월일:</b> {birth_date.strftime('%Y-%m-%d')}</p>
        <hr>
        <p><b>사주팔자:</b><br>
           {year_stem}{year_branch} / {month_stem}{month_branch} / {day_stem}{day_branch} / 미입력
        </p>
        <hr>
        <h3>🌟 성격</h3>
        <p>{report['성격']}</p>
        <h3>📍 현재 운세</h3>
        <p>{report['현재']}</p>
        <h3>🔮 미래 운세</h3>
        <p>{report['미래']}</p>
        <h3>💖 연애운</h3>
        <p>{report['연애']}</p>
        <h3>💰 재물운</h3>
        <p>{report['재물']}</p>
        <h3>📖 웹툰 캐릭터</h3>
        <p>{report['웹툰']}</p>
    </div>
    """, unsafe_allow_html=True)
