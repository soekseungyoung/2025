import streamlit as st
from datetime import datetime

# -------------------- í˜ì´ì§€ ì„¤ì • --------------------
st.set_page_config(page_title="ë‚´ê°€ ì›¹íˆ°ì— ë“¤ì–´ê°„ë‹¤ë©´?", page_icon="ğŸ“–", layout="centered")

# -------------------- ìŠ¤íƒ€ì¼ --------------------
st.markdown(
    """
    <style>
    /* stApp ë°°ê²½ì— ë³„ìë¦¬ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ */
    .stApp::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: black;
        z-index: -2;
    }

    .stars {
        position: fixed;
        top: 0;
        left: 0;
        width: 1px;
        height: 1px;
        background: transparent;
        box-shadow: 
            100px 200px #FFD700, 
            300px 600px #FFD700,
            700px 150px #FFD700,
            900px 400px #FFD700,
            1200px 250px #FFD700,
            500px 800px #FFD700,
            1300px 700px #FFD700;
        animation: animStar 50s linear infinite;
        z-index: -1;
    }

    .stars:after {
        content: " ";
        position: absolute;
        top: 2000px;
        width: 1px;
        height: 1px;
        background: transparent;
        box-shadow: 
            100px 200px #FFD700, 
            300px 600px #FFD700,
            700px 150px #FFD700,
            900px 400px #FFD700,
            1200px 250px #FFD700,
            500px 800px #FFD700,
            1300px 700px #FFD700;
    }

    @keyframes animStar {
        from { transform: translateY(0px); }
        to { transform: translateY(-2000px); }
    }

    /* ì œëª© */
    .title {
        font-size: 50px;
        font-weight: bold;
        text-align: center;
        margin-bottom: 25px;
        color: #FFD700;
        text-shadow: 0px 0px 15px rgba(255,215,0,0.9), 0px 0px 30px rgba(255,215,0,0.7);
    }

    /* ê²°ê³¼ ë°•ìŠ¤ */
    .result-box {
        background: rgba(20,20,20,0.85);
        padding: 30px;
        border-radius: 20px;
        border: 2px solid #FFD700;
        box-shadow: 0px 0px 20px rgba(255,215,0,0.6);
        margin-top: 30px;
    }

    h2, h3 {
        color: #FFD700;
        text-shadow: 0px 0px 6px rgba(255,215,0,0.7);
    }

    p {
        font-size: 16px;
        line-height: 1.8;
        color: #f5f5dc;
    }

    hr {
        border: 1px solid #FFD700;
        margin: 20px 0;
    }

    .stRadio label {
        color: #FFD700 !important;
    }
    </style>

    <div class="stars"></div>
    """,
    unsafe_allow_html=True
)

# -------------------- ì œëª© --------------------
st.markdown('<div class="title">ë‚´ê°€ ì›¹íˆ°ì— ë“¤ì–´ê°„ë‹¤ë©´?</div>', unsafe_allow_html=True)
st.write("âœ¨ ë³„ë¹› ì•„ë˜ í™©ê¸ˆë¹› ì‚¬ì£¼í’€ì´ë¡œ ë‹¹ì‹ ì˜ ì›¹íˆ° ìºë¦­í„° ìš´ëª…ì„ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤ âœ¨")

# -------------------- ì…ë ¥ --------------------
with st.form("user_form"):
    name = st.text_input("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”")
    gender = st.radio("ì„±ë³„ì„ ì„ íƒí•˜ì„¸ìš”", ["ì—¬ì", "ë‚¨ì"])
    birth_date = st.date_input("ìƒë…„ì›”ì¼", min_value=datetime(1900,1,1), max_value=datetime(2025,12,31))
    birth_time = st.time_input("ì¶œìƒ ì‹œê°„")
    submitted = st.form_submit_button("ê²°ê³¼ ë³´ê¸°")

# -------------------- ì‚¬ì£¼ ê¸°ë³¸ ë°ì´í„° --------------------
heavenly_stems = ["ê°‘(ëª©)", "ì„(ëª©)", "ë³‘(í™”)", "ì •(í™”)", "ë¬´(í† )", "ê¸°(í† )", "ê²½(ê¸ˆ)", "ì‹ (ê¸ˆ)", "ì„(ìˆ˜)", "ê³„(ìˆ˜)"]
earthly_branches = ["ì(ìˆ˜)", "ì¶•(í† )", "ì¸(ëª©)", "ë¬˜(ëª©)", "ì§„(í† )", "ì‚¬(í™”)", "ì˜¤(í™”)", "ë¯¸(í† )", "ì‹ (ê¸ˆ)", "ìœ (ê¸ˆ)", "ìˆ (í† )", "í•´(ìˆ˜)"]

# ì˜¤í–‰ë³„ ìƒì„¸ ë¦¬í¬íŠ¸
element_report = {
    "ëª©": {"ì„±ê²©": "ëŠì„ì—†ëŠ” ì„±ì¥ê³¼ ë„ì „ì„ ì¶”êµ¬í•˜ëŠ” íƒ€ì…. ì›¹íˆ° ì†ì—ì„œëŠ” ëŠ˜ ìƒˆë¡œìš´ ì„¸ê³„ë¥¼ ê°œì²™í•˜ëŠ” ì¸ë¬¼ì…ë‹ˆë‹¤.",
          "ëŒ€ì¸ê´€ê³„": "ì£¼ë³€ì— í™œë ¥ì„ ì£¼ê³  ë¦¬ë”ì‹­ì„ ë°œíœ˜í•˜ì§€ë§Œ, ê³ ì§‘ì´ ê°•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
          "í˜„ì¬": "ìƒˆë¡œìš´ ê¸°íšŒê°€ ë‹¤ê°€ì˜¤ê³  ìˆìœ¼ë©°, ëª¨í—˜ì‹¬ì´ ê°•í•˜ê²Œ ë°œíœ˜ë˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.",
          "ë¯¸ë˜": "í° ì„±ì·¨ë¥¼ ì´ë£¨ê³  ì§€ë„ìì  ìœ„ì¹˜ì— ì„¤ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.",
          "ì›¹íˆ°ìºë¦­í„°": "ì›¹íˆ° ì† ëª¨í—˜ê°€, ë„ì „ì ì¸ ì£¼ì¸ê³µ"},
    "í™”": {"ì„±ê²©": "ì—´ì •ê³¼ ì¶”ì§„ë ¥ì´ ê°•í•œ íƒ€ì…. ì¹´ë¦¬ìŠ¤ë§ˆê°€ ë„˜ì¹˜ë©° ê°ì •ì— ì†”ì§í•©ë‹ˆë‹¤.",
          "ëŒ€ì¸ê´€ê³„": "ì‚¬ëŒë“¤ì—ê²Œ í™œë ¥ì„ ì£¼ì§€ë§Œ ë•Œë¡œëŠ” ê³¼ì—´ëœ ê°ì •ìœ¼ë¡œ ê°ˆë“±ì´ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
          "í˜„ì¬": "ë¶ˆê½ƒ ê°™ì€ ì—ë„ˆì§€ë¡œ ì›í•˜ëŠ” ê²ƒì„ í–¥í•´ ëŒì§„í•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.",
          "ë¯¸ë˜": "í° ì„±ê³µì„ ì´ë£¨ì§€ë§Œ ì¡°ê¸‰í•¨ì„ ë‹¤ìŠ¤ë ¤ì•¼ í•©ë‹ˆë‹¤.",
          "ì›¹íˆ°ìºë¦­í„°": "ë¶ˆê½ƒ ì „ì‚¬, ì•¡ì…˜ì˜ ì¤‘ì‹¬ ì¸ë¬¼"},
    "í† ": {"ì„±ê²©": "ì•ˆì •ì ì´ê³  ë“ ë“ í•œ íƒ€ì…. ì„±ì‹¤í•˜ê³  ë¯¿ìŒì„ ì£¼ëŠ” ì„±ê²©ì…ë‹ˆë‹¤.",
          "ëŒ€ì¸ê´€ê³„": "ì‚¬ëŒë“¤ì„ í¸ì•ˆí•˜ê²Œ ë§Œë“¤ë©° ë²„íŒ€ëª©ì´ ë˜ì–´ì¤ë‹ˆë‹¤.",
          "í˜„ì¬": "ì„±ì‹¤í•¨ì´ ì¸ì •ë°›ê³  ìˆìœ¼ë©° ì•ˆì •ì ì¸ íë¦„ì´ ì´ì–´ì§€ê³  ìˆìŠµë‹ˆë‹¤.",
          "ë¯¸ë˜": "ì˜¤ë«ë™ì•ˆ ì¡´ê²½ë°›ëŠ” ì¡°ì–¸ìë‚˜ ë©˜í† ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
          "ì›¹íˆ°ìºë¦­í„°": "ì§€í˜œë¡œìš´ ì¡°ë ¥ì, ë“ ë“ í•œ ë©˜í† "},
    "ê¸ˆ": {"ì„±ê²©": "ëƒ‰ì² í•˜ê³  ê²°ë‹¨ë ¥ ìˆëŠ” íƒ€ì…. ì¹´ë¦¬ìŠ¤ë§ˆì™€ ê°•í•œ ì˜ì§€ë¥¼ ê°€ì¡ŒìŠµë‹ˆë‹¤.",
          "ëŒ€ì¸ê´€ê³„": "ì¡´ê²½ì„ ë°›ì§€ë§Œ ì°¨ê°‘ê²Œ ë³´ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
          "í˜„ì¬": "ëª©í‘œë¥¼ í–¥í•´ ì§‘ì¤‘í•  ìˆ˜ ìˆëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.",
          "ë¯¸ë˜": "ê¶Œìœ„ì™€ ëª…ì˜ˆë¥¼ ì–»ìœ¼ë©° ê°•ë ¬í•œ ì¸ìƒì„ ë‚¨ê¹ë‹ˆë‹¤.",
          "ì›¹íˆ°ìºë¦­í„°": "ê°•ë ¥í•œ ë¼ì´ë²Œ, ì¹´ë¦¬ìŠ¤ë§ˆ ìºë¦­í„°"},
    "ìˆ˜": {"ì„±ê²©": "ì§€í˜œë¡­ê³  ì‹ ë¹„ë¡œìš´ íƒ€ì…. ì§ê´€ë ¥ì´ ë›°ì–´ë‚˜ë©° ìƒí™©ì— ìœ ì—°í•©ë‹ˆë‹¤.",
          "ëŒ€ì¸ê´€ê³„": "íƒ€ì¸ì˜ ë§ˆìŒì„ ì´í•´í•˜ë©° ì‹ ë¹„ë¡œìš´ ë§¤ë ¥ìœ¼ë¡œ ì´ë•ë‹ˆë‹¤.",
          "í˜„ì¬": "ì§ê´€ì´ ë¹›ë‚˜ê³  ìƒˆë¡œìš´ ì•„ì´ë””ì–´ê°€ ë– ì˜¤ë¥´ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.",
          "ë¯¸ë˜": "ì§€í˜œë¥¼ ë°”íƒ•ìœ¼ë¡œ íŠ¹ë³„í•œ ê¸¸ì„ ê±¸ì–´ê°‘ë‹ˆë‹¤.",
          "ì›¹íˆ°ìºë¦­í„°": "ë¹„ë°€ì„ ê°„ì§í•œ í˜„ì, ì‹ ë¹„ë¡œìš´ ì¸ë¬¼"}
}

# -------------------- ê²°ê³¼ ê³„ì‚° --------------------
if submitted:
    year, month, day, hour = birth_date.year, birth_date.month, birth_date.day, birth_time.hour
    year_stem, year_branch = heavenly_stems[year % 10], earthly_branches[year % 12]
    month_stem, month_branch = heavenly_stems[month % 10], earthly_branches[month % 12]
    day_stem, day_branch = heavenly_stems[day % 10], earthly_branches[day % 12]
    hour_stem, hour_branch = heavenly_stems[hour % 10], earthly_branches[hour % 12]

    # ì˜¤í–‰ ì¶”ì¶œ
    elements = [s[-2] for s in [year_stem, month_stem, day_stem, hour_stem]]
    main_element = max(set(elements), key=elements.count)
    report = element_report.get(main_element, {
        "ì„±ê²©": "ë…ì°½ì ì´ê³  ê°œì„± ìˆëŠ” ì„±ê²©ì„ ì§€ë…”ìŠµë‹ˆë‹¤.",
        "ëŒ€ì¸ê´€ê³„": "íŠ¹ë³„í•œ ì¸ì—°ì„ ë§Œë“¤ì–´ë‚´ëŠ” í˜ì´ ìˆìŠµë‹ˆë‹¤.",
        "í˜„ì¬": "ì§€ê¸ˆì€ ë³€í™”ë¥¼ ì•ë‘ê³  ìˆëŠ” ì¤‘ìš”í•œ ì‹œì ì…ë‹ˆë‹¤.",
        "ë¯¸ë˜": "ì•ìœ¼ë¡œ ë‹¹ì‹ ì˜ ê¸¸ì€ íŠ¹ë³„í•˜ê³  ë…ì°½ì ìœ¼ë¡œ í¼ì³ì§‘ë‹ˆë‹¤.",
        "ì›¹íˆ°ìºë¦­í„°": "ê°œì„± ê°•í•œ ë…íŠ¹í•œ ìºë¦­í„°"
    })

    # -------------------- ì¶œë ¥ --------------------
    st.markdown(
        f"""
        <div class="result-box">
            <h2>ğŸ”® {name}ë‹˜ì˜ ì›¹íˆ° ìºë¦­í„° ë¦¬í¬íŠ¸</h2>
            <p><b>ì„±ë³„:</b> {gender}</p>
            <p><b>ìƒë…„ì›”ì¼:</b> {birth_date.strftime('%Y-%m-%d')}</p>
            <p><b>ì¶œìƒì‹œê°:</b> {birth_time.strftime('%H:%M')}</p>
            <hr>
            <p><b>ì‚¬ì£¼íŒ”ì:</b><br>
               {year_stem} {year_branch} / {month_stem} {month_branch} / {day_stem} {day_branch} / {hour_stem} {hour_branch}
            </p>
            <hr>
            <h3>ğŸŒŸ ì„±ê²©</h3>
            <p>{report['ì„±ê²©']}</p>
            <h3>ğŸ¤ ëŒ€ì¸ê´€ê³„</h3>
            <p>{report['ëŒ€ì¸ê´€ê³„']}</p>
            <h3>ğŸ“ í˜„ì¬ ìš´ì„¸</h3>
            <p>{report['í˜„ì¬']}</p>
            <h3>ğŸ”® ë¯¸ë˜ ìš´ì„¸</h3>
            <p>{report['ë¯¸ë˜']}</p>
            <h3>ğŸ“– ì›¹íˆ° ìºë¦­í„° í•´ì„</h3>
            <p>{report['ì›¹íˆ°ìºë¦­í„°']}</p>
        </div>
        """,
        unsafe_allow_html=True
    )
